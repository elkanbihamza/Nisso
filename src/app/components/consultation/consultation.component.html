<mat-sidenav-container class="consultation-sidenav-container">
  <mat-sidenav mode="side" opened class="history-sidenav">
    <div class="history-header">
      <h3>Consultation History</h3>
    </div>
    <mat-list>
      <mat-list-item *ngFor="let history of consultationHistory" (click)="viewHistoryDetails(history)">
        <div class="history-item">
          <div class="history-date">{{history.date | date:'dd/MM/yyyy'}}</div>
          <div class="history-diagnosis">{{history.diagnosis}}</div>
        </div>
      </mat-list-item>
    </mat-list>
  </mat-sidenav>

  <mat-sidenav-content>
    <div class="consultation-container">
      <div class="patient-info-card">
        <mat-card>
          <mat-card-content>
            <div class="patient-info">
              <span><strong>Patient:</strong> {{patient.prenom_patient}} {{patient.nom_patient}}</span>
              <span><strong>Birth Date:</strong> {{patient.birth_date | date}}</span>
              <span><strong>Gender:</strong> {{patient.gender}}</span>
              <span><strong>Phone:</strong> {{patient.phone_number}}</span>
            </div>
          </mat-card-content>
        </mat-card>
      </div>

      <form [formGroup]="consultationForm" (ngSubmit)="onSubmit()" class="consultation-form">
        <div class="vital-signs-row">
          <mat-form-field appearance="outline">
            <mat-label>Temperature (°C)</mat-label>
            <input matInput type="number" formControlName="temperature" placeholder="36.5">
            <mat-error *ngIf="consultationForm.get('temperature')?.errors?.['required']">Required</mat-error>
            <mat-error *ngIf="consultationForm.get('temperature')?.errors?.['min'] || consultationForm.get('temperature')?.errors?.['max']">
              Must be between 35°C and 42°C
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Systolic BP (mmHg)</mat-label>
            <input matInput type="number" formControlName="systolicBP" placeholder="120">
            <mat-error *ngIf="consultationForm.get('systolicBP')?.errors?.['required']">Required</mat-error>
            <mat-error *ngIf="consultationForm.get('systolicBP')?.errors?.['min'] || consultationForm.get('systolicBP')?.errors?.['max']">
              Must be between 70 and 200 mmHg
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Diastolic BP (mmHg)</mat-label>
            <input matInput type="number" formControlName="diastolicBP" placeholder="80">
            <mat-error *ngIf="consultationForm.get('diastolicBP')?.errors?.['required']">Required</mat-error>
            <mat-error *ngIf="consultationForm.get('diastolicBP')?.errors?.['min'] || consultationForm.get('diastolicBP')?.errors?.['max']">
              Must be between 40 and 130 mmHg
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>SPO2 (%)</mat-label>
            <input matInput type="number" formControlName="spo2" placeholder="98">
            <mat-error *ngIf="consultationForm.get('spo2')?.errors?.['required']">Required</mat-error>
            <mat-error *ngIf="consultationForm.get('spo2')?.errors?.['min'] || consultationForm.get('spo2')?.errors?.['max']">
              Must be between 70% and 100%
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Weight (kg)</mat-label>
            <input matInput type="number" formControlName="weight" placeholder="70">
            <mat-error *ngIf="consultationForm.get('weight')?.errors?.['required']">Required</mat-error>
            <mat-error *ngIf="consultationForm.get('weight')?.errors?.['min'] || consultationForm.get('weight')?.errors?.['max']">
              Must be between 0 and 500 kg
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Height (cm)</mat-label>
            <input matInput type="number" formControlName="height" placeholder="170">
            <mat-error *ngIf="consultationForm.get('height')?.errors?.['required']">Required</mat-error>
            <mat-error *ngIf="consultationForm.get('height')?.errors?.['min'] || consultationForm.get('height')?.errors?.['max']">
              Must be between 0 and 300 cm
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>BPM</mat-label>
            <input matInput type="number" formControlName="bpm" placeholder="80">
            <mat-error *ngIf="consultationForm.get('bpm')?.errors?.['required']">Required</mat-error>
            <mat-error *ngIf="consultationForm.get('bpm')?.errors?.['min'] || consultationForm.get('bpm')?.errors?.['max']">
              Must be between 40 and 200 BPM
            </mat-error>
          </mat-form-field>
        </div>

        <mat-form-field appearance="outline">
          <mat-label>Symptoms</mat-label>
          <textarea matInput formControlName="symptoms" rows="3"></textarea>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Diagnosis</mat-label>
          <textarea matInput formControlName="diagnosis" rows="3"></textarea>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Treatment</mat-label>
          <textarea matInput formControlName="treatment" rows="3"></textarea>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Additional Notes</mat-label>
          <textarea matInput formControlName="notes" rows="3"></textarea>
        </mat-form-field>

        <div class="form-actions">
          <button mat-button type="button" (click)="router.navigate(['/patients'])">Cancel</button>
          <button mat-raised-button color="primary" type="submit" [disabled]="!consultationForm.valid">
            Save Consultation
          </button>
        </div>
      </form>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container> 